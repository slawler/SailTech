
#---Load Modules
from __future__ import print_function
import os
import glob
import time
import numpy as np
import matplotlib as mpl
mpl.use('Agg')
import matplotlib.pyplot as plt
import pandas as pd
from datetime import datetime 
import time
import schedule
import subprocess
import html5lib


url = 'https://raw.githubusercontent.com/slawler/SailTech/master/logs/Temperature.log'
cols = ['time','sensor', 'obs']

df= pd.read_csv(url, header = None, sep = '\t' ,names = cols)
df= df.set_index(pd.to_datetime(df['time'],format = '%d.%Y.%m %H:%M:%S'))
df.drop(labels='time',axis=1, inplace= True)
df = df.groupby([pd.TimeGrouper('{}min'.format(1)), 'sensor']).agg({'obs': np.mean})
df = df.unstack()
df.columns = df.columns.droplevel()
df.head()
    

#---PLot data from most recent log
plt.ioff()
fig = df.plot()
plt.title('Pegasus Temperature Log'+ '\n Begining {}'.format(df.index[0]))
plt.ylabel('Temperature (F)')
plt.xlabel('Time')
plt.grid(True)
plt.ylim((0,30))

plt.savefig('temp.png')
plt.close()
